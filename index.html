<!DOCTYPE html>
<html>
<head>
    <title>Story Submission Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
    background-color: #333;
    color: #FFF;
    font-family: 'Space Grotesk', sans-serif;
    width: 100%;
    max-width: 700px;
    margin: auto;
    padding: 20px;
}

textarea {
    width: 100%;
    padding: 10px;
    font-family: 'Space Grotesk', sans-serif;
    margin-bottom: 20px;
    box-sizing: border-box;
    color: #000;
    resize: none;
}

#countdown {
    font-weight: bold;
}

input[type="text"], select {
    width: 100%;
    padding: 10px;
    margin: 5px 0 20px 0;
    display: inline-block;
    border: none;
    border-radius: 4px;
    box-sizing: border-box;
}

input[type="submit"] {
    width: 100%;
    background-color: #333;
    color: #FFF;
    padding: 14px 20px;
    margin: 20px 0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Space Grotesk', sans-serif;
}

input[type="submit"]:hover {
    background-color: #111;
}

.turn-wrapper {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}

.left-col {
    flex: 0 0 60%;
}

.right-col {
    flex: 1;
}

.turn-title {
    position: absolute;
    margin-left: -50px;
    font-size: 24px;
}

#navigation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 10px;
    background: rgba(0,0,0,0.7);
    z-index: 10;
    display: flex;
    justify-content: space-between;
}

#navigation button {
    margin-right: 10px;
}

    </style>
</head>
<body>
    <!-- Content goes here -->

<!-- This is your timer display -->
<div id="timer">
  <h1 id="countdown"></h1>
</div>

<!-- This is your form -->
<form id="form" method="post">
  <label for="userPersonality">User Personality:</label>
  <textarea id="userPersonality" name="userPersonality" rows="4" cols="50"></textarea>

  <label for="objective">Objective:</label>
  <textarea id="objective" name="objective" rows="4" cols="50"></textarea>

  <label for="backstory">Backstory:</label>
  <textarea id="backstory" name="backstory" rows="4" cols="50"></textarea>

  <!-- Turns will be added here by the JavaScript -->
</form>

<!-- This is your add turn button -->
<button id="addTurn">Add Turn</button>

<!-- This is your submit button -->
<input type="submit" value="Submit" id="submit">

<!-- The JavaScript code will go here -->
<script>
        var countdown = 60 * 60, timer;

function startTimer() {
    var minutes, seconds;
    timer = setInterval(function () {
        minutes = parseInt(countdown / 60, 10);
        seconds = parseInt(countdown % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        document.getElementById('countdown').innerText = minutes + ":" + seconds;

        if (--countdown < 0) {
            clearInterval(timer);
        }
    }, 1000);
}

startTimer();

var turns = 1;

function addTurn() {
    var form = document.getElementById('form');
    var turnHTML = generateTurnHTML(turns);
    form.innerHTML += turnHTML;
    turns++;
}

function generateTurnHTML(turn) {
    var html = `
    <div id="turn${turn}" class="turn">
        <div class="turn-wrapper">
            <div class="left-col">
                <div class="turn-title">${turn}</div>
                <label for="user${turn}">User:</label>
                <textarea id="user${turn}" name="user${turn}" rows="4" cols="50"></textarea>
                <label for="bot${turn}">Bot:</label>
                <textarea id="bot${turn}" name="bot${turn}" rows="4" cols="50"></textarea>
            </div>
            <div class="right-col">
                <label for="source_link${turn}">Source Link:</label>
                <input type="text" id="source_link${turn}" name="source_link${turn}">
                <label for="source_research${turn}">Source Research:</label>
                <textarea id="source_research${turn}" name="source_research${turn}" rows="4" cols="50"></textarea>
            </div>
        </div>
        <label for="branding${turn}">Branding:</label>
        <input type="checkbox" id="branding${turn}" name="branding${turn}">
    </div>`;
    return html;
}

function addTurnToNavigation(turn) {
    var navigation = document.getElementById('navigation');
    navigation.innerHTML += `<button onclick="goToTurn(${turn})">Turn ${turn}</button>`;
}

function goToTurn(turn) {
    var turnDiv = document.getElementById(`turn${turn}`);
    turnDiv.scrollIntoView();
}

addTurn();
addTurnToNavigation(1);

document.getElementById('addTurn').addEventListener('click', function(e) {
    e.preventDefault();
    addTurn();
    addTurnToNavigation(turns-1);
});

function postData(url = '', data = {}) {
    return fetch(url, {
        method: 'POST', 
        mode: 'no-cors', 
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json());
}

document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();

    var data = {};
    var inputs = document.getElementsByTagName('input');
    var textareas = document.getElementsByTagName('textarea');

    for (var i = 0; i < inputs.length; i++) {
        data[inputs[i].name] = inputs[i].value;
    }

    for (var i = 0; i < textareas.length; i++) {
        data[textareas[i].name] = textareas[i].value;
    }

    postData('https://script.google.com/macros/s/AKfycbyALcX9piRnqVF-TAPxjS_kstscBom6AYBMjhYDJo9repQ-tQwEY_C2P1X9Ov0PmSsY/exec', data)
    .then(data => {
        console.log(data);
    });
});
    </script>
</body>
</html>
